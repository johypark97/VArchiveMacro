# VArchiveMacro

![screenshot](doc/screenshot.png)

VArchiveMacro는 로키 스튜디오(Rocky Studio)가 개발, 네오위즈(NEOWIZ)가 배급하는 PC
플랫폼 게임
[DJMAX RESPECT V](https://store.steampowered.com/app/960170/DJMAX_RESPECT_V/)의
유저 제작 웹 성과 관리 도구
[V-ARCHIVE](https://v-archive.net/)의 클라이언트 캡처 자동화를 지원하는 외부 매크로
프로그램 입니다.

현재 기록 뷰어와 콜렉션 메뉴 스캔 기능을 포함한 1.1 버전이 개발중에 있습니다.

## 설치 안내

사용을 위해서는 *JRE 17 (Java Runtime Environment 17)* 이 필요합니다.

JRE설치 환경에 따라 다음 세 가지 실행 파일을 제공합니다.

- `VArchive Macro vX.X.X.exe`

  시스템 전역에 설치되어 있는 JRE를 사용합니다.
  [JavaSoft 레지스트리 키](https://docs.azul.com/core/zulu-openjdk/install/windows#azul-zulu-registry-keys)
  를 제공하는 JRE를 설치하였을 경우 사용 가능합니다.

- `VArchive Macro env vX.X.X.exe`

  `%JAVA_HOME%` 환경 변수로 지정된 JRE를 사용합니다.

- `VArchive Macro local vX.X.X.exe`

  로컬에 설치된 JRE를 이용합니다. 참조하는 JRE의 루트 폴더는 실행 파일과 동일한 경로에
  `jre17` 이름으로 존재해야 합니다.

개발 및 테스트에 사용된 JRE는 Azul Zulu JDK입니다. local 설치 시 아래 공식 링크를 통해
설치하는 것을 권장합니다.

링크: <https://www.azul.com/downloads/?version=java-17-lts&os=windows&architecture=x86-64-bit&package=jre#zulu>

## 삭제 안내

프로그램을 삭제할 경우 다음의 파일들을 지워주세요.

1. 매크로 프로그램 파일
1. 설치한 JRE
1. 프로그램 캐시 폴더 (1회 이상 실행하였을 경우 생성)
    - 전체 경로: `C:\Users\[윈도우 계정 이름]\.javacpp`
    - 단축 경로: `%userprofile%\.javacpp`

## 기능

- **기록 뷰어**: 컴퓨터에 저장된 기록을 보여줍니다.
- **스캐너**: 인게임 콜렉션 메뉴를 통해 기록을 스캔합니다.
- **매크로**: V-ARCHIVE 클라이언트의 캡처 자동화를 도와주는 매크로 기능입니다.

## 사용법

- 기록 뷰어
  1. 좌측 패널에서 곡 이름을 선택하여 기록을 확인합니다.

  - 첫 실행 시에는 서버로부터 기록을 다운받아야 합니다.

- 스캐너
  1. 기록 뷰어에서 기록을 다운받지 않았다면 기록을 다운받습니다.
  1. 설정에서 계정 파일(`account.txt`) 을 선택하고 필요 시 캐시 디렉토리를 따로 지정합니다.
  1. 스캐너 탭에서 스캔하고자 하는 탭을 선택합니다. 이때 인게임 콜렉션 탭을 넘겨보았을 때
      곡이 전혀 표시되지 않는 탭이 있다면 해당 탭은 선택을 해제하는 것을 권장합니다.
  1. 인게임 콜렉션 메뉴의 `ALL` 탭이 표시되도록 놓은 뒤 `Ctrl + Home`을 눌러 스캔합니다.
      스캔은 도중에 `End` 키를 눌러 중단할 수 있습니다. 한 번 누르면 자동으로 `ALL`
      탭으로 되돌아가며, 다시 `End` 키를 누르면 모든 행동을 중지합니다.
  1. 스캔이 완료되면 자동으로 `ALL` 탭으로 돌아가 정지합니다.
  1. 태스크 탭에서 곡을 정확하게 인식하였는지 확인 및 선택합니다.
      - 인식한 제목과 정확히 일치하는 곡이 존재하여 찾아진 곡들은 녹색으로 표시되며 자동으로
        선택됩니다.
      - 정확하지 않아 확인이 필요한 곡들은 노란색으로 표시됩니다. 열을 선택 후 엔터 키
        또는 좌측 하단의 `보기`를 누르면 캡처한 사진이 표시되며, 사진의 제목과 인식한 곡이
        같은지 확인 후 같다면 좌측 선택 체크박스에 체크를, 그렇지 않다면 체크를 해제해주세요.
        인식한 곡의 정보는 `제목`, `작곡가`, `DLC`, `탭` 행에 표시됩니다.
      - 주요 행의 의미는 다음과 같습니다.
        - 정확도: 인식한 제목과 찾아진 곡의 제목의 유사도를 보여줍니다.
        - 차이: 인식한 제목과 찾아진 곡의 제목의 다른 글자 수를 보여줍니다.
        - 스캔된 제목: 스캐너가 인식한 곡의 제목을 표시합니다.
        - 제목, 작곡가, DLC, 탭: 스캔된 제목과 가장 유사한 곡으로 찾아진 곡의 제목, 작곡가,
          DLC, 탭 정보를 표시합니다.
  1. 확인 및 선택이 완료되면 우측 하단의 분석 버튼을 눌러 분석을 시작합니다.
  1. 분석이 완료되면 결과 탭에서 스캔 결과를 확인 및 업로드할 기록 데이터를 선택하여
      업로드합니다.

  - **사용 시 주의사항**
    - 스캔할 탭 선택 시 인게임에서 탭을 넘겨보았을 때 곡이 뜨지 않는 탭이 있다면 가능하면
      해당 탭은 선택하지 않는 것을 추천합니다.
    - 스캔은 반드시 `ALL` 탭에서 시작해야 합니다.
    - 스캔이 정상적으로 완료되었다면 반드시 `ALL` 탭으로 다시 올아옵니다. `ALL` 탭으로
      돌아오지 않았다면 다시 스캔해주세요.
    - 저사양 컴퓨터이거나 고부하 작업을 진행중인 경우에 스캐너를 사용하는 경우 렉이
      발생하여 키 입력이 무시되어 스캔이 정상적으로 이루어지지 않을 가능성이 높습니다.
      하단의 설정 문단을 참조하여 캡처 딜레이와 키 입력 시간을 늘리고 한 탭씩 스캔해주세요.

- 매크로
  1. 인게임 프리스타일 모드에서 난이도 순서로 정렬합니다.
  1. `Alt + [` 또는 `Alt + ]`을 눌러 매크로를 실행합니다.

  - **사용 시 주의사항**
    - 사용 시 V-ARCHIVE 클라이언트가 실행되어 있어야 합니다.
    - 매크로 기능은 단순히 위 또는 아래로만 이동하여 곡만 변경하며, 패턴은 변경하지 않습니다.
      난이도 순서 정렬하지 않고 실행할 경우 노말 패턴만 인식되니 반드시 난이도 순서로
      정렬 후 사용해주세요.

### 단축키

- `Ctrl + Home`: 콜렉션 메뉴 스캔을 시작합니다.
- `Alt + [`: 위 방향으로 클라이언트 매크로를 시작합니다.
- `Alt + ]`: 아래 방향으로 클라이언트 매크로를 시작합니다.
- `End`: 진행중인 작업을 중단합니다.

### 제한 및 주의사항

현재 v1.1.0은 개발중인 버전으로 다음과 같은 제한 및 주의사항이 존재합니다.

1. 스캐너
    1. 스캐너 지원 해상도
        스캐너는 빠른 스캔을 위해 매크로 기능과 다르게 자체 캡처 기능을 사용하며, 현재 개발
        버전 기준으로는 아직 **창모드 스캔을 지원하지 않습니다.** 또한 다중 모니터
        환경에서의 스캔 기능은 지원되지 않아 현재 **모니터 1에 한해서만 캡처가
        가능합니다.**

        현재 지원 해상도는 다음과 같습니다.
        - FHD (1920 x 1080), 전체화면 / 보더리스 창모드

    1. 스캐너 사용 시 인게임 언어 설정이 `한국어 (Korean)`로 설정되어 있어야 합니다.
        곡명 인식은 한국어 기준으로 되어있어 한국어로 설정해야 정상적으로 스캔이 가능합니다.

    1. 캡처 중 키보드 및 마우스를 조작하지 마세요. 캡처가 잘못될 가능성이 있습니다.

## 설정

- 공통
  - 슬라이더: 슬라이더를 이용하는 설정값은 마우스 우클릭으로 기본값 초기화가 가능합니다.
    또한 우측의 텍스트 입력란에 값을 입력하여 슬라이더 입력 범위를 일부 초과하는 값을 설정할
    수 있습니다.
  - 캡처 딜레이: 캡처 직전 기다리는 시간을 지정합니다.
    저사양 컴퓨터 또는 다른 고부하 작업을 동시에 진행하는 경우 등 화면 업데이트가 느려지거나
    렉이 발생하는 경우 이를 늘려 잘못 스캔되는 문제를 해결할 수 있습니다.
  - 키 입력 지속시간: 키를 누르고 있는 시간을 지정합니다.
    키 입력이 무시될 경우 이를 올려주세요.

- 스캐너
  - 계정 파일: `account.txt` 파일 경로를 지정합니다. 기록 업로드 시 계정 인증에 사용됩니다.
  - 캐시 디렉토리: 스캔 과정 중 캡처한 사진을 임시 저장할 경로를 지정합니다.
    *FHD(1920 x 1080)* 기준으로 약 **500MB**가 사용됩니다.
  - 기록 업로드 딜레이: 기록 업로드 사이 기다리는 시간을 지정합니다.
    서버의 부하를 낮추기 위해 사용하는 설정값입니다.
  - 캡처 딜레이: 공통 항목 참조.
  - 키 입력 지속시간: 공통 항목 참조.

- 매크로
  - 분석 키: V-ARCHIVE 클라이언트에서 분석하기 위해 사용할 키를 지정합니다.
  - 횟수: 매크로를 실행할 횟수를 지정합니다.
  - 캡처 딜레이: 곡 이동 후 캡처 전 기다리는 시간을 지정합니다.
    매크로의 경우, 이 값이 너무 작으면 곡 이동 중 캡처되어 V-ARCHIVE 클라이언트에서 정확한
    분석을 할 수 없습니다.
  - 캡처 지속시간: 캡처에 사용되는 시간을 지정합니다. 캡처가 되지 않는 등의 문제가 발생하는
    경우 이 값을 올려주세요.
  - 키 입력 지속시간: 공통 항목 참조.

## 알려진 문제

- 매크로
  - *클라이언트에 "지원하지 않는 해상도 NxM" 라는 메시지가 뜨며 캡처가 되지 않습니다.*

    게임 윈도우가 포커스 되지 않았을 가능성이 있습니다. 게임 윈도우를 한 번 클릭해 주세요.

    매크로는 스캐너 기능과 다르게 윈도우의 프린터 스크린샷 기능을 이용하여 캡처합니다.
    게임 화면만을 정확히 캡처하기 위해 `Alt + PrtSc` 키를 이용하는데, 이는 현재 포커스
    되어있는 창만 잘라내어 캡처하는 기능입니다. 지원하는 해상도 이외에 다른 해상도 크기가
    지원되지 않는다는 메시지의 경우 이 포커스가 게임 윈도우가 아닌 다른 윈도우에 맞추어졌을
    수 있습니다. 그림판을 켜고 붙여넣기를 하면 마지막으로 캡처된 화면을 볼 수 있습니다.

  - *인벤토리 창(F11) 이 켜집니다.*

    분석 키로 `Alt + F11`이 지정되어 있어 발생하는 문제일 가능성이 있습니다. 매크로
    설정에서 분석 키를 다른 것으로 변경해보세요.

- 스캐너
  - *Alone은 한 개 밖에 뜨지 않고 중복됨이라 뜹니다.*

    Alone 곡은 같은 제목의 곡이 두 개가 존재하며, 동시에 같은 RESPECT 탭에 있어
    제목만으로는 구분이 불가하여 해당 문제가 발생합니다. 제목과 탭이 동시에 중복되는 곡은
    현재는 인식이 불가합니다.

  - *스캔한 제목 중에 정확한 곡명이 존재하는데 너무나도 다른 곡으로 인식합니다.*

    현재 베타1 버전에서 스캐너는 모든 곡을 탭 단위로 스캔하며 각각의 탭에 대해서 스캔할 때
    해당 탭에 존재할 수 있는 곡들에 대해서만 가장 일치하는 곡을 찾도록 되어있습니다.

    그런데 탭을 넘기라는 키 명령을 스캐너가 주었지만 렉 등으로 인해 실제로는 탭이 넘어가지
    않았다면 찾는 곡 목록이 바뀌어 실제로 제목은 인식하여도 완전히 다른 곡을 찾게 되어
    이러한 문제가 발생하게 됩니다.

    저사양 컴퓨터에서 테스트 중에 렉으로 인해 탭이 넘어가지 않아 `RESPECT` 탭의 `WHY`가
    바로 다음 `PORTABLE 1` 탭에 존재하는 `Can We Talk`으로 인식된 적이 있습니다.

    이 문제는 키 입력 시간을 넉넉히 주고 반드시 마지막 `ALL` 탭으로 돌아오는지 확인하는
    것으로 해결이 가능합니다.

  - *FHD (1920 x 1080) 해상도로 맞추었는데도 `not supported resolution: NxM`
  과 같은 메시지가 뜨며 스캔이 안됩니다.*

    윈도우 설정의 디스플레이 배율이 100%로 설정되어 있지 않은 경우 이러한 문제가 발생합니다.
    윈도우 설정 - 시스템 - 디스플레이에서 배율이 100%가 아니라면 100%로 설정해주세요.

    | 배율 \[%\] | 오류 메시지의 해상도 |
    |-|-|
    | 125 | 1536 x 864 |
    | 150 | 1280 x 720 |
    | 175 | 1097 x 617 |

## 업데이트 내역

- v1.1.0-beta2
  - 시즌 11과 V Extension 5 DLC 대응 업데이트
  - 데이터베이스 구조 변경

- v1.1.0-beta1
  - 모든 곡들을 제목을 이용하여 인식하도록 스캐너 개선
  - 시즌 10과 Maple Story DLC 대응 업데이트

- v1.1.0-alpha3
  - V Extension 4 DLC 대응 업데이트
  - 스캐너 안전 모드 추가
  - 스캐너 사용성 개선
    - 스캔 완료 또는 중단 이후 `ALL` 탭으로 돌아가도록 변경
    - 태스크 탭의 태스크를 정렬 가능하도록 변경 및 엔터 키와 방향 키를 이용하여 여러
      태스크를 빠르게 볼 수 있도록 개선
    - 결과 탭에 결과를 상단 100개만 선택할 수 있는 버튼 추가

- v1.1.0-alpha2
  - 시즌 9 대응 업데이트
  - 스캐너 사용성 개선
    - 업로드 버튼에 경고 및 확인 대화창 추가
    - 태스크 탭에서 각각의 DLC 탭의 마지막 두 곡에 해당하는 행의 색을 강조
    - 태스크 탭에 작곡가, DLC 및 DLC 탭 정보를 추가
    - 결과 탭에 정확도 증가량 정보를 추가

- v1.1.0-alpha1-hotfix1
  - 스캐너에서 곡과 캡처한 이미지를 잘못 매칭하는 버그 개선
    - 일부 탭을 고정에서 해제하여 스캔 가능하도록 변경
    - 스캐너 사용 방법 변경

- v1.1.0-alpha1
  - 개발중인 기록 뷰어 및 스캐너 기능 추가

- v1.0
  - 첫 릴리즈

## 기타

- *VArchiveMacro의 앱 아이콘은 Over Me 곡의 커버 이미지에서 가져왔으며 이의 저작권은
  NEOWIZ 사에 있습니다.*
